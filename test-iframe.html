<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Iframe Embedding - Signature Animation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        .note {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .success {
            background: #d4edda;
            border-color: #28a745;
        }
        .error {
            background: #f8d7da;
            border-color: #dc3545;
        }
        iframe {
            width: 100%;
            height: 540px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto;
            font-family: monospace;
            margin: 20px 0;
        }
        .test-buttons {
            margin: 20px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        #console {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            min-height: 100px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .log-error { color: #f48771; }
        .log-success { color: #4ec9b0; }
        .log-info { color: #9cdcfe; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Iframe Embedding Test</h1>
        
        <div class="note">
            <strong>‚ö†Ô∏è Important:</strong> This test file demonstrates how the iframe would work with proper headers.
            On GitHub Pages, the iframe may not load due to X-Frame-Options restrictions.
            Deploy to Netlify/Vercel for full functionality.
        </div>

        <h2>Test 1: GitHub Pages URL</h2>
        <p>Testing with current GitHub Pages deployment:</p>
        <!-- SECURITY NOTE: This iframe uses sandbox="allow-scripts allow-same-origin"
             
             Why both are required:
             - allow-scripts: Enables the JavaScript animation to run
             - allow-same-origin: Allows the iframe to load its own CSS/JS files and external 
               resources (Google Fonts, background images) via CORS
             
             Security implications:
             - This combination removes most sandboxing protections
             - The iframe can access cookies, localStorage, and perform same-origin requests
             - If iframe content is compromised, it could access parent page resources (if same origin)
             
             This is the minimal permission set required for the animation to function.
             Removing either permission would break the application.
             
             Alternative: Consider hosting the iframe content on a separate subdomain to maintain
             origin isolation while still allowing these permissions. -->
        <iframe 
            id="github-iframe"
            src="https://ilghar.github.io/Signature-animation/"
            title="Signature animation on GitHub Pages"
            sandbox="allow-scripts allow-same-origin"
            loading="lazy">
        </iframe>
        <div id="github-status" class="note error">
            Status: Loading... (May fail due to GitHub Pages X-Frame-Options)
        </div>

        <h2>Test 2: After Netlify Deployment</h2>
        <p>After deploying to Netlify, update the URL below and test:</p>
        <div class="code-block">
            <div>Replace with your Netlify URL:</div>
            <input type="text" id="netlify-url" placeholder="https://your-site.netlify.app" 
                   style="width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div class="test-buttons">
            <button onclick="testNetlifyUrl()">Test Netlify URL</button>
            <button onclick="checkHeaders()">Check Headers</button>
            <button onclick="clearConsole()">Clear Console</button>
        </div>
        <!-- SECURITY NOTE: This iframe uses sandbox="allow-scripts allow-same-origin"
             See detailed security explanation in the first iframe comment above. -->
        <iframe 
            id="netlify-iframe"
            title="Signature animation on Netlify"
            sandbox="allow-scripts allow-same-origin"
            loading="lazy"
            style="display: none;">
        </iframe>
        <div id="netlify-status" class="note" style="display: none;">
            Status: Not tested yet
        </div>

        <h2>Debug Console</h2>
        <div id="console"></div>

        <h2>Expected Iframe Code for Adobe Portfolio</h2>
        <p>Use this code in Adobe Portfolio after deploying to Netlify:</p>
        <div class="note">
            <strong>‚ö†Ô∏è Security Note:</strong> The sandbox attribute uses both <code>allow-scripts</code> and 
            <code>allow-same-origin</code>, which are the minimum permissions required for this animation to function. 
            While this reduces sandboxing protection, it's necessary for loading external resources and running the animation. 
            For improved security, consider hosting the iframe on a separate subdomain.
        </div>
        <div class="code-block">
&lt;iframe
  src="https://your-site-name.netlify.app"
  title="Signature animation"
  style="width:100%; height:540px; border:0; overflow:hidden;"
  loading="lazy"
  sandbox="allow-scripts allow-same-origin"&gt;
&lt;/iframe&gt;
        </div>

        <h2>Sandbox Security Considerations</h2>
        <div class="note">
            <p><strong>Why these sandbox permissions are necessary:</strong></p>
            <ul>
                <li><strong>allow-scripts:</strong> Required for the JavaScript animation to execute</li>
                <li><strong>allow-same-origin:</strong> Required for:
                    <ul>
                        <li>Loading the iframe's own CSS and JavaScript files</li>
                        <li>Accessing external resources (Google Fonts, background images) via CORS</li>
                        <li>Proper functioning of the animation</li>
                    </ul>
                </li>
            </ul>
            <p><strong>Security tradeoffs:</strong></p>
            <ul>
                <li>‚úÖ <strong>Good:</strong> Only the minimum required permissions are granted</li>
                <li>‚úÖ <strong>Good:</strong> No form, popup, or navigation permissions</li>
                <li>‚ö†Ô∏è <strong>Consideration:</strong> The combination of allow-scripts + allow-same-origin removes most sandbox protections</li>
                <li>‚ö†Ô∏è <strong>Consideration:</strong> If iframe content were compromised, it could access cookies and localStorage</li>
            </ul>
            <p><strong>Best practice:</strong> For production use, consider hosting the iframe content on a separate subdomain 
            (e.g., animation.yourdomain.com) to maintain origin isolation while still allowing these necessary permissions.</p>
        </div>

        <h2>Troubleshooting</h2>
        <ul>
            <li><strong>GitHub Pages iframe blocked:</strong> Expected. Deploy to Netlify/Vercel to fix.</li>
            <li><strong>Console shows CSP errors:</strong> Check that headers are properly configured.</li>
            <li><strong>Blank iframe:</strong> Check browser console (F12) for specific error messages.</li>
            <li><strong>Resources not loading:</strong> Verify HTTPS and CORS settings.</li>
        </ul>

        <h2>Header Requirements</h2>
        <p>For iframe embedding to work, the server should send:</p>
        <div class="code-block">
Content-Security-Policy: frame-ancestors *
<br><br>
<strong>And should NOT send:</strong><br>
X-Frame-Options: DENY
<br><br>
<em>‚úÖ The correct CSP header is automatically configured in the deployment files (_headers, netlify.toml, vercel.json)</em>
        </div>
    </div>

    <script>
        const consoleDiv = document.getElementById('console');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logClass = type === 'error' ? 'log-error' : type === 'success' ? 'log-success' : 'log-info';
            consoleDiv.innerHTML += `<div class="${logClass}">[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function clearConsole() {
            consoleDiv.innerHTML = '';
            log('Console cleared', 'info');
        }

        // Check GitHub iframe load
        const githubIframe = document.getElementById('github-iframe');
        githubIframe.addEventListener('load', function() {
            log('GitHub Pages iframe loaded successfully!', 'success');
            document.getElementById('github-status').className = 'note success';
            document.getElementById('github-status').textContent = 'Status: ‚úÖ Loaded (surprising if on GitHub Pages!)';
        });
        
        githubIframe.addEventListener('error', function() {
            log('GitHub Pages iframe failed to load (expected due to X-Frame-Options)', 'error');
            document.getElementById('github-status').className = 'note error';
            document.getElementById('github-status').textContent = 'Status: ‚ùå Blocked by X-Frame-Options (expected on GitHub Pages)';
        });

        // Test Netlify URL
        function testNetlifyUrl() {
            const url = document.getElementById('netlify-url').value.trim();
            if (!url) {
                log('Please enter a Netlify URL first', 'error');
                return;
            }
            
            log(`Testing URL: ${url}`, 'info');
            const netlifyIframe = document.getElementById('netlify-iframe');
            const statusDiv = document.getElementById('netlify-status');
            
            netlifyIframe.style.display = 'block';
            statusDiv.style.display = 'block';
            statusDiv.className = 'note';
            statusDiv.textContent = 'Status: Loading...';
            netlifyIframe.src = url;
            
            netlifyIframe.addEventListener('load', function() {
                log('Netlify iframe loaded successfully!', 'success');
                statusDiv.className = 'note success';
                statusDiv.textContent = 'Status: ‚úÖ Loaded successfully! Headers are configured correctly.';
            });
            
            netlifyIframe.addEventListener('error', function() {
                log('Netlify iframe failed to load', 'error');
                statusDiv.className = 'note error';
                statusDiv.textContent = 'Status: ‚ùå Failed to load. Check URL and headers.';
            });
        }

        // Check headers
        async function checkHeaders() {
            const url = document.getElementById('netlify-url').value.trim() || 'https://ilghar.github.io/Signature-animation/';
            log(`Checking headers for: ${url}`, 'info');
            
            try {
                const response = await fetch(url, { method: 'HEAD', mode: 'cors' });
                log('Response received, checking headers...', 'info');
                
                const xFrameOptions = response.headers.get('x-frame-options');
                const csp = response.headers.get('content-security-policy');
                
                // Check X-Frame-Options
                if (xFrameOptions) {
                    const xfoUpper = xFrameOptions.toUpperCase();
                    if (xfoUpper === 'DENY') {
                        log(`X-Frame-Options: ${xFrameOptions} (will block iframe)`, 'error');
                    } else if (xfoUpper === 'SAMEORIGIN') {
                        log(`X-Frame-Options: ${xFrameOptions} (allows same-origin only)`, 'info');
                    } else {
                        log(`X-Frame-Options: ${xFrameOptions}`, 'info');
                    }
                } else {
                    log('X-Frame-Options: Not set (good for iframe embedding)', 'success');
                }
                
                log(`Content-Security-Policy: ${csp || 'Not set'}`, 'info');
                
                // Determine if embedding will work
                if (xFrameOptions && xFrameOptions.toUpperCase() === 'DENY') {
                    log('‚ùå X-Frame-Options: DENY will block iframe embedding', 'error');
                } else if (csp && csp.includes('frame-ancestors')) {
                    // Check for permissive frame-ancestors values
                    if (csp.includes('frame-ancestors *')) {
                        log('‚úÖ CSP frame-ancestors: * allows iframe embedding from any origin!', 'success');
                    } else if (csp.includes("frame-ancestors 'none'")) {
                        log('‚ùå CSP frame-ancestors: none blocks iframe embedding', 'error');
                    } else if (csp.includes("frame-ancestors 'self'")) {
                        log('‚ö†Ô∏è CSP frame-ancestors: self allows same-origin embedding only', 'info');
                    } else {
                        log('‚ö†Ô∏è CSP frame-ancestors has specific restrictions - check value', 'info');
                    }
                } else if (!xFrameOptions) {
                    log('‚úÖ No restrictive headers - iframe embedding should work!', 'success');
                } else {
                    log('‚ÑπÔ∏è Check actual embedding to verify', 'info');
                }
            } catch (error) {
                log(`Error checking headers: ${error.message}`, 'error');
                log('This may be due to CORS restrictions. Try after deployment.', 'info');
            }
        }

        // Initial log
        log('Iframe embedding test page loaded', 'success');
        log('Testing GitHub Pages URL automatically...', 'info');
        
        // Monitor console for CSP errors
        window.addEventListener('error', function(e) {
            if (e.message.includes('frame') || e.message.includes('CSP')) {
                log(`Browser error: ${e.message}`, 'error');
            }
        });

        // Check after 3 seconds if iframe hasn't loaded
        setTimeout(function() {
            try {
                githubIframe.contentWindow.location.href;
                log('GitHub iframe is accessible', 'success');
            } catch (e) {
                log('Cannot access GitHub iframe content (likely blocked by X-Frame-Options)', 'error');
            }
        }, 3000);
    </script>
</body>
</html>
